<?php
session_start();
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admission Form</title>
  <link rel="stylesheet" href="admission.css">
  <style>
    .form { display: none; }
    .form.active { display: block; }
    .step { display: none; }
    .step.active { display: block; }
    .success-message { display: none; text-align: center; }
    .success-message.active { display: block; }
    .error { color: red; font-size: 0.9em; }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #eef3ff;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Student Admission Form</h2>
    <form id="admissionForm" class="form active">
      <input type="hidden" name="user_id" value="<?php echo $_SESSION['user_id'] ?? 1; ?>">
      
      <!-- Step 1 -->
      <div id="step1" class="step active">
        <div class="form-group">
          <label>Student Name</label>
          <input type="text" name="student_name" id="student_name" required>
        </div>
        <div class="form-group">
          <label>CNIC</label>
          <input type="text" name="cnic" id="cnic" required 
                 oninput="this.value = this.value.replace(/[^0-9\-]/g, '').slice(0, 15);">
        </div>
        <div class="form-group">
          <label>Father Name</label>
          <input type="text" name="father_name" id="father_name" required>
        </div>
        <div class="form-group">
          <label>Gender</label>
          <select name="gender" id="gender" required>
            <option value="">-- Select Gender --</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
            <option value="prefer_not_to_say">Prefer not to say</option>
          </select>
        </div>
        <div class="form-group">
          <label>Last Degree</label>
          <select name="last_degree" id="last_degree" required>
            <option value="">-- Select Last Degree --</option>
            <option value="Matric">Matric</option>
            <option value="Intermediate">Intermediate</option>
            <option value="Undergraduate">Undergraduate</option>
            <option value="Graduate">Graduate</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <button type="button" class="btn" onclick="nextStep()">Next</button>
      </div>

      <!-- Step 2 -->
      <div id="step2" class="step">
        <div class="form-group">
          <label>Phone</label>
          <input type="text" name="phone" id="phone" required 
                 oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11);">
        </div>
        <div class="form-group">
          <label>Address</label>
          <input type="text" name="address" id="address" required>
        </div>
        
        <div class="form-group">
          <label>City</label>
          <select name="city" id="city" required>
            <option value="">-- Select City --</option>
            <option value="Faisalabad">Faisalabad</option>
            <option value="Karachi">Karachi</option>
            <option value="Lahore">Lahore</option>
            <option value="T.T Singh">T.T Singh</option>
            <option value="Islamabad">Islamabad</option>
            <option value="Multan">Multan</option>
            <option value="Sargodha">Sargodha</option>
          </select>
        </div>

        <div class="form-group">
          <label>Province</label>
          <select name="province" id="province" required>
            <option value="">-- Select Province --</option>
            <option value="Punjab">Punjab</option>
            <option value="Sindh">Sindh</option>
            <option value="KPK">KPK</option>
            <option value="Balochistan">Balochistan</option>
            <option value="Kashmir">Kashmir</option>
            <option value="GB">GB</option>
          </select>
        </div>

        <div class="form-group">
          <label>Postal Code</label>
          <input type="text" name="postal_code" id="postal_code" required>
        </div>
        <div class="form-buttons">
          <button type="button" class="btn back" onclick="prevStep()">Back</button>
          <button type="submit" class="btn">Submit</button>
        </div>
      </div>
    </form>

    <div id="success" class="success-message">
      <h3>ðŸŽ‰ Admission Submitted Successfully!</h3>
      <p>Thank you for registering. Weâ€™ll contact you soon.</p>
    </div>
  </div>

  <script>
    function nextStep() {
      const cnic = document.getElementById('cnic').value.trim();
      const studentname = document.getElementById('student_name').value.trim();
      const fatherName = document.getElementById('father_name').value.trim();
      const gender = document.getElementById('gender').value;
      const lastDegree = document.getElementById('last_degree').value;
      const cnicPattern = /^[0-9]{5}-[0-9]{7}-[0-9]$/;

      if (!studentname || !cnic || !fatherName || !gender || !lastDegree) {
        alert("Please fill in all required fields.");
        return;
      }

      if (!cnicPattern.test(cnic)) {
        alert("Invalid CNIC format. Example: 12345-1234567-1");
        return;
      }
      document.getElementById('step1').classList.remove('active');
      document.getElementById('step2').classList.add('active');
    }

    function prevStep() {
      document.getElementById('step2').classList.remove('active');
      document.getElementById('step1').classList.add('active');
    }

    document.getElementById('admissionForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const phone = document.getElementById('phone').value.trim();
      const postalCode = document.getElementById('postal_code').value.trim();
      const phonePattern = /^[0-9]{11}$/;
      const postalPattern = /^[0-9]{5}$/;

      if (!phonePattern.test(phone)) {
        alert("Invalid Phone. It should be 11 digits.");
        return;
      }
      if (!postalPattern.test(postalCode)) {
        alert("Invalid Postal Code. It should be 5 digits.");
        return;
      }

      const formData = new FormData(this);
      fetch('admission.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(data => {
        if (data.trim() === 'success') {
          document.getElementById('admissionForm').classList.remove('active');
          document.getElementById('success').classList.add('active');
        } else {
          alert("âŒ " + data);
        }
      })
      .catch(err => console.error('Error:', err));
    });
  </script>
</body>
</html>
